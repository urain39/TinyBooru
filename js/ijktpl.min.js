var IJKTPL=function(){"use strict";function i(e,t){if(!e)throw new Error(t||"Assertion Failed!")}function s(e,t,n){i(this instanceof s),i("object"!=typeof elememt,"Need an object-like element!"),function(e,t,n,i){e._element=t,e._mapper=n,e._options=null,e._source=t.innerHTML;var s={prefix:"[[",suffix:"]]",debug:!(e._ast=[])};for(var r in i)s[r]=i[r];e._options=s,void 0===e._source&&("function"==typeof t.html?(e._element=t[0],e._source=t.html()):e._die("Invalid element object!"))}(this,e,t||{},n||{})}return s.prototype._die=function(n){return function(e,t){throw new SyntaxError(n)}()},s.prototype._precheck=function(e,t,n){!function(e,t,n,i){var s=0,r=0,o=0,u=!0;for(s=0;s<t.length;s++)u&&t.substr(s,n.length)===n?(o=s,u=!1,s+=n.length-1):u||t.substr(s,i.length)!==i?u||t.substr(s,n.length)!==n||e._die("No Closing Token["+r+"] at the '"+t.substring(o,s)+"'"):(u=!0,s+=i.length-1,r+=1);u||e._die("Missing '"+i+"' at the '"+t.substring(o,s)+"'")}(this,e,t,n)},s.prototype._valueOf=function(u,p){return function(e,t,n){var i,s,r,o;for(s=p,r=(o=u.split(".")).length-1,i=0;i<r;i++)"object"!=typeof s[o[i]]&&e._die("Subtoken parent '"+o[i]+"' is not an object!"),s=s[o[i]];return s[o[r]]}(this)},s.prototype.parse=function(e){return function(e,t,n){var i=[],s=n.prefix||"[[",r=n.suffix||"]]";e._precheck(t,s,r);var o,u,p,h,c,a,l,f,d,_,g=[],b=s+"@",k=r;for(o=0;o<t.length;o++)if(t.substr(o,s.length)!==s)g.push(t[o]);else{switch(u=o+s.length,-1===(p=t.indexOf(r,u))&&e._die("Missing '"+r+"'"),g.length&&(i.push({op:">",content:g.join("")}),g.length=0),h=(c=t.substring(u,p)).substr(0,1),p+=r.length,h){case"?":a=s+":"+(c=c.substr(1))+r,l=s+";"+c+r,-1===(u=t.indexOf(a,p))?(-1===(u=t.indexOf(l,p))&&e._die("Missing '"+l+"'"),(f=t.substring(p,u))&&(f=e.parse(f))):((f=t.substring(p,u))&&(f=e.parse(f)),p=u+a.length,-1===(u=t.indexOf(l,p))&&e._die("Missing '"+l+"'"),(d=t.substring(p,u))&&(d=e.parse(d))),(f||d)&&i.push({op:"?",id:c,thenBlock:f,elseBlock:d}),p=u+l.length;break;case"^":l=s+"$"+(c=c.substr(1))+r,-1===(u=t.indexOf(b,p))?e._die("Missing iteration binding with '"+b+"'"):(p=u+b.length,u=t.indexOf(k,p),_=t.substring(u,p),p=u+k.length,-1===(u=t.indexOf(l,p))&&e._die("Missing '"+l+"'"),f=t.substring(p,u)),f&&i.push({op:"^",id:c,bind:_,thenBlock:e.parse(f)}),p=u+l.length;break;default:i.push({op:"#",id:c})}o=p-1}return g.length&&i.push({op:">",content:g.join("")}),i}(this,e||this._source,this._options)},s.prototype._astRender=function(e,t){return function(e,t,n){var i,s,r,o,u,p=[];for(i=0;i<t.length;i++)switch(t[i].op){case"?":(u=e._valueOf(t[i].id,n))?p.push(e._astRender(t[i].thenBlock,n)):p.push(e._astRender(t[i].elseBlock,n));break;case"^":if("object"==typeof(u=e._valueOf(t[i].id,n))&&"number"==typeof u.length){for(r in s={},n)s[r]=n[r];for(o=0;o<u.length;o++)s[t[i].bind]=u[o],p.push(e._astRender(t[i].thenBlock,s))}else e._die("Token '"+t[i].id+"' is not iterble");break;case">":p.push(t[i].content);break;case"#":p.push(e._valueOf(t[i].id,n))}return p=p.join("")}(this,e,t)},s.prototype.render=function(e){return n=(t=this)._ast,i=e||{},s=t._astRender(n,i),t._element.innerHTML=s;var t,n,i,s},s.prototype.compile=function(){return(e=this)._ast=e.parse(e._source),e.render(e._mapper);var e},s.prototype.rebind=function(e,t,n){var i,s,r,o;i=this,s=e,r=t||this._mapper,o=n||this._options,i.constructor(s,r,o)},s}();"object"==typeof exports&&(exports.IJKTPL=IJKTPL);