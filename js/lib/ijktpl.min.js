var IJKTPL=function(){"use strict";var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},l={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&quot;":'"',"&#39;":"'","&apos;":"'"};function o(e,t){if(!e)throw new Error(t||"Assertion Failed!")}function r(e,t,n){o(this instanceof r),o("object"!=typeof elememt,"Need an object-like element!"),function(e,t,n,o){e._element=t,e._mapper=n,e._options=null,e._source=t.innerHTML;var r={prefix:"[[",suffix:"]]",debug:!(e._ast=[])};for(var i in o)r[i]=o[i];e._options=r,void 0===e._source&&("function"==typeof t.html?(e._element=t[0],e._source=t.html()):e._die("Invalid element object!"))}(this,e,t||{},n||{})}return r.prototype._die=function(n){return function(e,t){throw new SyntaxError(n)}()},r.prototype._valueOf=function(p,u){return function(e,t,n){var o,r,i,s;for(r=u,i=(s=p.split(".")).length-1,o=0;o<i;o++)"object"!=typeof r[s[o]]&&e._die("Subtoken parent '"+s[o]+"' is not an object!"),r=r[s[o]];return r[s[i]]}(this)},r.prototype.parse=function(e){return function(e,t,n){var o,r,i,s,p,u,a,c,l,f,h,d=[],_=n.prefix||"[[",g=n.suffix||"]]",b=[],k=_+"@",m=g;for(o=0;o<t.length;o++)if(t.substr(o,_.length)!==_)b.push(t[o]);else{switch(r=o+_.length,-1===(i=t.indexOf(g,r))&&e._die("Missing '"+g+"'"),b.length&&(d.push({op:">",content:b.join("")}),b.length=0),s=(u=t.substring(r,i)).substr(0,1),i+=g.length,s){case"?":a=_+":"+(u=u.substr(1))+g,c=_+";"+u+g,-1===(r=t.indexOf(c,i))&&e._die("Missing '"+c+"'"),l=(p=(l=t.substring(i,r)).split(a,2))[0],f=p[1],l&&(l=e.parse(l)),f&&(f=e.parse(f)),(l||f)&&d.push({op:"?",id:u,thenBlock:l,elseBlock:f}),i=r+c.length;break;case"^":c=_+"$"+(u=u.substr(1))+g,-1===(r=t.indexOf(k,i))?e._die("Missing iteration binding with '"+k+"'"):(i=r+k.length,r=t.indexOf(m,i),h=t.substring(r,i),i=r+m.length,-1===(r=t.indexOf(c,i))&&e._die("Missing '"+c+"'"),l=t.substring(i,r)),l&&d.push({op:"^",id:u,bind:h,thenBlock:e.parse(l)}),i=r+c.length;break;default:d.push({op:"#",id:u})}o=i-1}return b.length&&d.push({op:">",content:b.join("")}),d}(this,e||this._source,this._options)},r.prototype._astRender=function(e,t,n){return function(e,t,n,o){var r,i,s,p,u,a;for(r=0;r<n.length;r++)switch(n[r].op){case"?":(u=e._valueOf(n[r].id,o))?n[r].thenBlock&&e._astRender(t,n[r].thenBlock,o):n[r].elseBlock&&e._astRender(t,n[r].elseBlock,o);break;case"^":if("object"==typeof(u=e._valueOf(n[r].id,o))&&"number"==typeof u.length){for(s in i={},o)i[s]=o[s];for(p=0;p<u.length;p++)i[n[r].bind]=u[p],n[r].thenBlock&&e._astRender(t,n[r].thenBlock,i)}else e._die("Token '"+n[r].id+"' is not iterble");break;case">":t.push(n[r].content.replace(/&amp;|&lt;|&gt;|&#34;|&quot;|&#39;|&apos;/g,function(e){return l[e]}));break;case"#":t.push("string"==typeof(a=e._valueOf(n[r].id,o))?a.replace(/[&<>"']/g,function(e){return c[e]}):a)}}(this,e,t,n)},r.prototype.render=function(e){return n=(t=this)._ast,o=e||{},r=[],t._astRender(r,n,o),t._element.innerHTML=r.join(""),r;var t,n,o,r},r.prototype.compile=function(){return(e=this)._ast=e.parse(e._source),e.render(e._mapper);var e},r.prototype.rebind=function(e,t,n){var o,r,i,s;o=this,r=e,i=t||this._mapper,s=n||this._options,o.constructor(r,i,s)},r}();"object"==typeof exports&&(exports.IJKTPL=IJKTPL);