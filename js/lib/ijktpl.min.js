var IJKTPL=function(){"use strict";var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},l={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&quot;":'"',"&#39;":"'","&apos;":"'"};function r(e,t){if(!e)throw new Error(t||"Assertion Failed!")}function i(e,t,n){r(this instanceof i),r("object"!=typeof elememt,"Need an object-like element!"),function(e,t,n,r){e._element=t,e._mapper=n,e._options=null,e._source=t.innerHTML;var i={prefix:"[[",suffix:"]]",debug:!(e._ast=[])};for(var s in r)i[s]=r[s];e._options=i,void 0===e._source&&("function"==typeof t.html?(e._element=t[0],e._source=t.html()):e._die("Invalid element object!"))}(this,e,t||{},n||{})}return i.prototype._die=function(n){return function(e,t){throw new SyntaxError(n)}()},i.prototype._precheck=function(e,t,n){!function(e,t,n,r){var i=0,s=0,o=0,u=!0;for(i=0;i<t.length;i++)u&&t.substr(i,n.length)===n?(o=i,u=!1,i+=n.length-1):u||t.substr(i,r.length)!==r?u||t.substr(i,n.length)!==n||e._die("No Closing Token["+s+"] at the '"+t.substring(o,i)+"'"):(u=!0,i+=r.length-1,s+=1);u||e._die("Missing '"+r+"' at the '"+t.substring(o,i)+"'")}(this,e,t,n)},i.prototype._valueOf=function(u,p){return function(e,t,n){var r,i,s,o;for(i=p,s=(o=u.split(".")).length-1,r=0;r<s;r++)"object"!=typeof i[o[r]]&&e._die("Subtoken parent '"+o[r]+"' is not an object!"),i=i[o[r]];return i[o[s]]}(this)},i.prototype.parse=function(e){return function(e,t,n){var r=[],i=n.prefix||"[[",s=n.suffix||"]]";e._precheck(t,i,s);var o,u,p,a,h,l,c,f,g,d,_=[],b=i+"@",v=s;for(o=0;o<t.length;o++)if(t.substr(o,i.length)!==i)_.push(t[o]);else{switch(u=o+i.length,-1===(p=t.indexOf(s,u))&&e._die("Missing '"+s+"'"),_.length&&(r.push({op:">",content:_.join("")}),_.length=0),a=(h=t.substring(u,p)).substr(0,1),p+=s.length,a){case"?":l=i+":"+(h=h.substr(1))+s,c=i+";"+h+s,-1===(u=t.indexOf(l,p))?(-1===(u=t.indexOf(c,p))&&e._die("Missing '"+c+"'"),g=null,(f=t.substring(p,u))&&(f=e.parse(f))):((f=t.substring(p,u))&&(f=e.parse(f)),p=u+l.length,-1===(u=t.indexOf(c,p))&&e._die("Missing '"+c+"'"),(g=t.substring(p,u))&&(g=e.parse(g))),(f||g)&&r.push({op:"?",id:h,thenBlock:f,elseBlock:g}),p=u+c.length;break;case"^":c=i+"$"+(h=h.substr(1))+s,-1===(u=t.indexOf(b,p))?e._die("Missing iteration binding with '"+b+"'"):(p=u+b.length,u=t.indexOf(v,p),d=t.substring(u,p),p=u+v.length,-1===(u=t.indexOf(c,p))&&e._die("Missing '"+c+"'"),f=t.substring(p,u)),f&&r.push({op:"^",id:h,bind:d,thenBlock:e.parse(f)}),p=u+c.length;break;default:r.push({op:"#",id:h})}o=p-1}return _.length&&r.push({op:">",content:_.join("")}),r}(this,e||this._source,this._options)},i.prototype._astRender=function(e,t){return function(e,t,n){var r,i,s,o,u,p,a=[];if(!t)return"";for(r=0;r<t.length;r++)switch(t[r].op){case"?":(u=e._valueOf(t[r].id,n))?a.push(e._astRender(t[r].thenBlock,n)):a.push(e._astRender(t[r].elseBlock,n));break;case"^":if("object"==typeof(u=e._valueOf(t[r].id,n))&&"number"==typeof u.length){for(s in i={},n)i[s]=n[s];for(o=0;o<u.length;o++)i[t[r].bind]=u[o],a.push(e._astRender(t[r].thenBlock,i))}else e._die("Token '"+t[r].id+"' is not iterble");break;case">":a.push(t[r].content.replace(/&amp;|&lt;|&gt;|&#34;|&quot;|&#39;|&apos;/g,function(e){return l[e]}));break;case"#":a.push("string"==typeof(p=e._valueOf(t[r].id,n))?p.replace(/[&<>"']/g,function(e){return h[e]}):p)}return a=a.join("")}(this,e,t)},i.prototype.render=function(e){return n=(t=this)._ast,r=e||{},i=n?t._astRender(n,r):"",t._element.innerHTML=i;var t,n,r,i},i.prototype.compile=function(){return(e=this)._ast=e.parse(e._source),e.render(e._mapper);var e},i.prototype.rebind=function(e,t,n){var r,i,s,o;r=this,i=e,s=t||this._mapper,o=n||this._options,r.constructor(i,s,o)},i}();"object"==typeof exports&&(exports.IJKTPL=IJKTPL);