var IJKTPL=function(){"use strict";var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},l={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&quot;":'"',"&#39;":"'","&apos;":"'"};function i(e,t){if(!e)throw new Error(t||"Assertion Failed!")}function o(e,t,n){i(this instanceof o),i("object"!=typeof elememt,"Need an object-like element!"),function(e,t,n,i){e._element=t,e._mapper=n,e._options=null,e._source=t.innerHTML;var o={prefix:"[[",suffix:"]]",debug:!(e._ast=[])};for(var r in i)o[r]=i[r];e._options=o,void 0===e._source&&("function"==typeof t.html?(e._element=t[0],e._source=t.html()):e._die("Invalid element object!"))}(this,e,t||{},n||{})}return o.prototype._die=function(n){return function(e,t){throw new SyntaxError(n)}()},o.prototype._valueOf=function(p,u){return function(e,t,n){var i,o,r,s;for(o=u,r=(s=p.split(".")).length-1,i=0;i<r;i++)"object"!=typeof o[s[i]]&&e._die("Subtoken parent '"+s[i]+"' is not an object!"),o=o[s[i]];return o[s[r]]}(this)},o.prototype.parse=function(e){return function(e,t,n){var i,o,r,s,p,u,c,a,l,f,h,d=[],_=n.prefix||"[[",g=n.suffix||"]]",b=[],k=_+"@",m=g;for(i=0;i<t.length;i++)if(t.substr(i,_.length)!==_)b.push(t[i]);else{switch(o=i+_.length,-1===(r=t.indexOf(g,o))&&e._die("Missing '"+g+"'"),b.length&&(d.push({op:">",content:b.join("")}),b.length=0),s=(u=t.substring(o,r)).substr(0,1),r+=g.length,s){case"?":c=_+":"+(u=u.substr(1))+g,a=_+";"+u+g,-1===(o=t.indexOf(a,r))&&e._die("Missing '"+a+"'"),l=(p=(l=t.substring(r,o)).split(c,2))[0],f=p[1],l&&(l=e.parse(l)),f&&(f=e.parse(f)),(l||f)&&d.push({op:"?",id:u,thenBlock:l,elseBlock:f}),r=o+a.length;break;case"^":a=_+"$"+(u=u.substr(1))+g,-1===(o=t.indexOf(k,r))&&e._die("Missing binding begins with '"+k+"'"),r=o+k.length,-1===(o=t.indexOf(m,r))&&e._die("Missing binding ends with '"+m+"'"),h=t.substring(o,r),r=o+m.length,-1===(o=t.indexOf(a,r))&&e._die("Missing '"+a+"'"),(l=t.substring(r,o))&&d.push({op:"^",id:u,bind:h,thenBlock:e.parse(l)}),r=o+a.length;break;default:d.push({op:"#",id:u})}i=r-1}return b.length&&d.push({op:">",content:b.join("")}),d}(this,e||this._source,this._options)},o.prototype._astRender=function(e,t,n){return function(e,t,n,i){var o,r,s,p,u,c;for(o=0;o<n.length;o++)switch(n[o].op){case"?":(u=e._valueOf(n[o].id,i))?n[o].thenBlock&&e._astRender(t,n[o].thenBlock,i):n[o].elseBlock&&e._astRender(t,n[o].elseBlock,i);break;case"^":if("object"==typeof(u=e._valueOf(n[o].id,i))&&"number"==typeof u.length){for(s in r={},i)r[s]=i[s];for(p=0;p<u.length;p++)r[n[o].bind]=u[p],n[o].thenBlock&&e._astRender(t,n[o].thenBlock,r)}else e._die("Token '"+n[o].id+"' is not iterble");break;case">":t.push(n[o].content.replace(/&amp;|&lt;|&gt;|&#34;|&quot;|&#39;|&apos;/g,function(e){return l[e]}));break;case"#":t.push("string"==typeof(c=e._valueOf(n[o].id,i))?c.replace(/[&<>"']/g,function(e){return a[e]}):c)}}(this,e,t,n)},o.prototype.render=function(e){return n=(t=this)._ast,i=e||{},o=[],t._astRender(o,n,i),t._element.innerHTML=o.join(""),o;var t,n,i,o},o.prototype.compile=function(){return(e=this)._ast=e.parse(e._source),e.render(e._mapper);var e},o.prototype.rebind=function(e,t,n){var i,o,r,s;i=this,o=e,r=t||this._mapper,s=n||this._options,i.constructor(o,r,s)},o}();"object"==typeof exports&&(exports.IJKTPL=IJKTPL);