var IJKTPL=function(){"use strict";var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;","/":"&#47;","=":"&#61;","`":"&#96;"},l={"&amp;":"&","&lt;":"<","&gt;":">"};function o(e,t){if(!e)throw new Error(t||"Assertion Failed!")}function i(e,t,n){o(this instanceof i),o("object"!=typeof elememt,"Need an object-like element!"),function(e,t,n,o){e._element=t,e._mapper=n,e._options=null,e._source=t.innerHTML;var i={prefix:"[[",suffix:"]]",debug:!(e._ast=[])};for(var r in o)i[r]=o[r];e._options=i,void 0===e._source&&("function"==typeof t.html?(e._element=t[0],e._source=t.html()):e._die("Invalid element object!"))}(this,e,t||{},n||{})}return"function"==typeof NodeList&&"function"!=typeof NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){var n,o=this;for(n=0;n<o.length;n++)e.apply(t,[o[n],n,o])}),i.prototype._die=function(n){return function(e,t){throw new SyntaxError(n)}()},i.prototype._valueOf=function(p,u){return function(e,t,n){var o,i,r,s;for(i=u,r=(s=p.split(".")).length-1,o=0;o<r;o++)"object"!=typeof i[s[o]]&&e._die("Subtoken parent '"+s[o]+"' is not an object!"),i=i[s[o]];return i[s[r]]}(this)},i.prototype.parse=function(e){return function(e,t,n){var o,i,r,s,p,u,c,f,l,a,h,d=[],_=n.prefix||"[[",g=n.suffix||"]]",b=[],y=_+"@",k=g;for(o=0;o<t.length;o++)if(t.substr(o,_.length)!==_)b.push(t[o]);else{switch(i=o+_.length,-1===(r=t.indexOf(g,i))&&e._die("Missing '"+g+"'"),b.length&&(d.push({op:">",content:b.join("")}),b.length=0),s=(u=t.substring(i,r)).substr(0,1),r+=g.length,s){case"?":c=_+":"+(u=u.substr(1))+g,f=_+";"+u+g,-1===(i=t.indexOf(f,r))&&e._die("Missing '"+f+"'"),l=(p=(p=t.substring(r,i)).split(c,2))[0],a=p[1],l&&(l=e.parse(l)),a&&(a=e.parse(a)),(l||a)&&d.push({op:"?",id:u,thenBlock:l,elseBlock:a}),r=i+f.length;break;case"^":f=_+"$"+(u=u.substr(1))+g,-1===(i=t.indexOf(f,r))&&e._die("Missing '"+f+"'"),p=i,(-1===(i=t.indexOf(y,r))||p<i)&&e._die("Missing binding begins with '"+y+"'"),r=i+y.length,(-1===(i=t.indexOf(k,r))||p<i)&&e._die("Missing binding ends with '"+k+"'"),h=t.substring(r,i),r=i+k.length,(l=t.substring(r,p))&&d.push({op:"^",id:u,bind:h,thenBlock:e.parse(l)}),r=p+f.length;break;default:d.push({op:"#",id:u})}o=r-1}return b.length&&d.push({op:">",content:b.join("")}),d}(this,e||this._source,this._options)},i.prototype._renderAST=function(e,t,n){return function(e,t,n,o){var i,r,s,p,u,c;for(i=0;i<n.length;i++)switch(n[i].op){case"?":(u=e._valueOf(n[i].id,o))?n[i].thenBlock&&e._renderAST(t,n[i].thenBlock,o):n[i].elseBlock&&e._renderAST(t,n[i].elseBlock,o);break;case"^":if("object"==typeof(u=e._valueOf(n[i].id,o))&&"number"==typeof u.length){for(s in r={},o)r[s]=o[s];for(p=0;p<u.length;p++)r[n[i].bind]=u[p],n[i].thenBlock&&e._renderAST(t,n[i].thenBlock,r)}else e._die("Token '"+n[i].id+"' is not iterble");break;case">":t.push(n[i].content.replace(/&amp;|&lt;|&gt;/g,function(e){return l[e]}));break;case"#":t.push("string"==typeof(c=e._valueOf(n[i].id,o))?c.replace(/[&<>"'/`=]/g,function(e){return f[e]}):c)}}(this,e,t,n)},i.prototype.render=function(e){return n=(t=this)._ast,o=e||{},i=[],t._renderAST(i,n,o),t._element.innerHTML=i.join(""),i;var t,n,o,i},i.prototype.compile=function(){return(e=this)._ast=e.parse(e._source),e.render(e._mapper);var e},i.prototype.rebind=function(e,t,n){var o,i,r,s;o=this,i=e,r=t||this._mapper,s=n||this._options,o.constructor(i,r,s)},i}();"object"==typeof exports&&(exports.IJKTPL=IJKTPL);